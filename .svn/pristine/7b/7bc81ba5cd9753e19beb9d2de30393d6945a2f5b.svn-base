<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="TRepaymentPlanMapper" >
  <resultMap id="BaseResultMap" type="com.hrbb.loan.pos.dao.entity.TRepaymentPlan" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jul 30 09:30:28 CST 2015.
    -->
    <result column="receiptId" property="receiptid" jdbcType="VARCHAR" />
    <result column="period" property="period" jdbcType="VARCHAR" />
    <result column="schedDate" property="scheddate" jdbcType="DATE" />
    <result column="schedPrincipal" property="schedprincipal" jdbcType="DECIMAL" />
    <result column="schedInterest" property="schedinterest" jdbcType="DECIMAL" />
    <result column="unpaidInterest" property="unpaidinterest" jdbcType="DECIMAL" />
    <result column="schedTotalAmt" property="schedtotalamt" jdbcType="DECIMAL" />
    <result column="graceDays" property="gracedays" jdbcType="INTEGER" />
    <result column="reducedInterest" property="reducedinterest" jdbcType="DECIMAL" />
    <result column="memo" property="memo" jdbcType="VARCHAR" />
    <result column="owePrincipal" property="owePrincipal" jdbcType="DECIMAL" />
    <result column="oweInterest" property="oweInterest" jdbcType="DECIMAL" />
    <result column="overFlag" property="overFlag" jdbcType="VARCHAR" />
    <result column="payoffFlag" property="payoffFlag" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jul 30 09:30:28 CST 2015.
    -->
    receiptId, period, schedDate, schedPrincipal, schedInterest, unpaidInterest, 
    schedTotalAmt, graceDays, reducedInterest, memo, owePrincipal, oweInterest, overFlag, payoffFlag
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jul 30 09:30:28 CST 2015.
    -->
    select 
    <include refid="Base_Column_List" />
    from t_repayment_plan
    where id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jul 30 09:30:28 CST 2015.
    -->
    delete from t_repayment_plan
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.hrbb.loan.pos.dao.entity.TRepaymentPlan" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jul 30 09:30:28 CST 2015.
    -->
    insert into t_repayment_plan (id, receiptId, period, 
      schedDate, schedPrincipal, schedInterest, 
      unpaidInterest, schedTotalAmt, graceDays, 
      reducedInterest, memo, overFlag, payoffFlag)
    values (#{id,jdbcType=INTEGER}, #{receiptid,jdbcType=VARCHAR}, #{period,jdbcType=VARCHAR}, 
      #{scheddate,jdbcType=DATE}, #{schedprincipal,jdbcType=DECIMAL}, #{schedinterest,jdbcType=DECIMAL}, 
      #{unpaidinterest,jdbcType=DECIMAL}, #{schedtotalamt,jdbcType=DECIMAL}, #{gracedays,jdbcType=INTEGER}, 
      #{reducedinterest,jdbcType=DECIMAL}, #{memo,jdbcType=VARCHAR}, #{overFlag,jdbcType=VARCHAR}, #{payoffFlag,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.hrbb.loan.pos.dao.entity.TRepaymentPlan" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jul 30 09:30:28 CST 2015.
    -->
    insert into t_repayment_plan
    <trim prefix="(" suffix=")" suffixOverrides="," >
        receiptId,
        period,
      <if test="scheddate != null" >
        schedDate,
      </if>
      <if test="schedprincipal != null" >
        schedPrincipal,
      </if>
      <if test="schedinterest != null" >
        schedInterest,
      </if>
      <if test="unpaidinterest != null" >
        unpaidInterest,
      </if>
      <if test="schedtotalamt != null" >
        schedTotalAmt,
      </if>
      <if test="gracedays != null" >
        graceDays,
      </if>
      <if test="reducedinterest != null" >
        reducedInterest,
      </if>
      <if test="memo != null" >
        memo,
      </if>
      <if test="owePrincipal != null" >
        owePrincipal,
      </if>
      <if test="oweInterest != null" >
        oweInterest,
      </if>
      <if test="overFlag != null">
      	overFlag, 
      </if>
      <if test="payoffFlag != null">
      	payoffFlag,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
        #{receiptid,jdbcType=VARCHAR},
        #{period,jdbcType=VARCHAR},
      <if test="scheddate != null" >
        #{scheddate,jdbcType=DATE},
      </if>
      <if test="schedprincipal != null" >
        #{schedprincipal,jdbcType=DECIMAL},
      </if>
      <if test="schedinterest != null" >
        #{schedinterest,jdbcType=DECIMAL},
      </if>
      <if test="unpaidinterest != null" >
        #{unpaidinterest,jdbcType=DECIMAL},
      </if>
      <if test="schedtotalamt != null" >
        #{schedtotalamt,jdbcType=DECIMAL},
      </if>
      <if test="gracedays != null" >
        #{gracedays,jdbcType=INTEGER},
      </if>
      <if test="reducedinterest != null" >
        #{reducedinterest,jdbcType=DECIMAL},
      </if>
      <if test="memo != null" >
        #{memo,jdbcType=VARCHAR},
      </if>
      <if test="owePrincipal != null" >
        #{owePrincipal,jdbcType=DECIMAL},
      </if>
      <if test="oweInterest != null" >
        #{oweInterest,jdbcType=DECIMAL},
      </if> 
      <if test="overFlag != null">
      	#{overFlag,jdbcType=VARCHAR},
      </if>
      <if test="payoffFlag != null">
      	#{payoffFlag,jdbcType=VARCHAR},
      </if>
     
    </trim>
  </insert>
  <update id="updateSelective" parameterType="com.hrbb.loan.pos.dao.entity.TRepaymentPlan" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jul 30 09:30:28 CST 2015.
    -->
    update t_repayment_plan
    <set >
      <if test="scheddate != null" >
        schedDate = #{scheddate,jdbcType=DATE},
      </if>
      <if test="schedprincipal != null" >
        schedPrincipal = #{schedprincipal,jdbcType=DECIMAL},
      </if>
      <if test="schedinterest != null" >
        schedInterest = #{schedinterest,jdbcType=DECIMAL},
      </if>
      <if test="unpaidinterest != null" >
        unpaidInterest = #{unpaidinterest,jdbcType=DECIMAL},
      </if>
      <if test="schedtotalamt != null" >
        schedTotalAmt = #{schedtotalamt,jdbcType=DECIMAL},
      </if>
      <if test="gracedays != null" >
        graceDays = #{gracedays,jdbcType=INTEGER},
      </if>
      <if test="reducedinterest != null" >
        reducedInterest = #{reducedinterest,jdbcType=DECIMAL},
      </if>
      <if test="memo != null" >
        memo = #{memo,jdbcType=VARCHAR},
      </if>
      <if test="owePrincipal != null" >
        owePrincipal = #{owePrincipal,jdbcType=DECIMAL},
      </if>
      <if test="oweInterest != null" >
        oweInterest = #{oweInterest,jdbcType=DECIMAL},
      </if> 
      <if test="overFlag != null">
      	overFlag = #{overFlag,jdbcType=VARCHAR},
      </if>
      <if test="payoffFlag != null">
      	payoffFlag = #{payoffFlag,jdbcType=VARCHAR},
      </if>
    </set>
    where receiptId = #{receiptid,jdbcType=VARCHAR}
      <if test="period != null" >
       and period = #{period,jdbcType=VARCHAR}
      </if>
  </update>
  <update id="updateByPrimaryKey" parameterType="com.hrbb.loan.pos.dao.entity.TRepaymentPlan" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jul 30 09:30:28 CST 2015.
    -->
    update t_repayment_plan
    set receiptId = #{receiptid,jdbcType=VARCHAR},
      period = #{period,jdbcType=VARCHAR},
      schedDate = #{scheddate,jdbcType=DATE},
      schedPrincipal = #{schedprincipal,jdbcType=DECIMAL},
      schedInterest = #{schedinterest,jdbcType=DECIMAL},
      unpaidInterest = #{unpaidinterest,jdbcType=DECIMAL},
      schedTotalAmt = #{schedtotalamt,jdbcType=DECIMAL},
      graceDays = #{gracedays,jdbcType=INTEGER},
      reducedInterest = #{reducedinterest,jdbcType=DECIMAL},
      memo = #{memo,jdbcType=VARCHAR},
  	  overFlag = #{overFlag,jdbcType=VARCHAR},
      payoffFlag = #{payoffFlag,jdbcType=VARCHAR}
    where id = #{id,jdbcType=INTEGER}
  </update>
  
  <select id="getRecentlyPlan" resultMap="BaseResultMap" parameterType="java.lang.String">
  	select 
    <include refid="Base_Column_List" />
    from t_repayment_plan
    where receiptId = #{receiptid,jdbcType=VARCHAR}
    and payoffFlag = '00'
    order by schedDate asc
    limit 0,1
  </select>
  
  <select id="getRepaymentPlans" resultMap="BaseResultMap" parameterType="Map">
  	select 
    <include refid="Base_Column_List" />
    from t_repayment_plan
    where receiptId = #{receiptid,jdbcType=VARCHAR}
    <if test="dateFrom != null" >
        schedDate &gt;= #{dateFrom,jdbcType=DATE}
    </if> 
    order by schedDate asc
  </select>
  
  <select id="getRepaymentPlansByPayApplyId" resultType="Map" parameterType="Map">
	  select 
	    DATE_FORMAT(a.schedDate,'%Y%m%d') schddate, 
		period schdperiod,
		schedPrincipal schdprincipal,
		schedInterest schdinterest,
		schedTotalAmt schdtotal

	    from t_repayment_plan a left join t_receipt_info b on a.receiptId = b.receiptId
	    where b.payApplyId = #{payApplyId}
	    order by schedDate
	    <if test="startNum != null" >
	        limit #{startNum}, #{recNum}
	    </if> 
  </select>
  
  <select id="countRepaymentPlans" resultType="String" parameterType="Map">
  	select count(*) from t_repayment_plan a left join t_receipt_info b on a.receiptId = b.receiptId
	    where b.payApplyId = #{payApplyId} 
  </select>

	<select id="countRepaymentPlansByReceiptId" resultType="java.lang.Long" parameterType="java.lang.String">
		select count(*) from t_repayment_plan where receiptId = #{receiptId}
	</select>

	<select id="selectByReceiptIdInPage" resultMap="BaseResultMap"
		parameterType="Map">
		select * from t_repayment_plan where receiptId = #{receiptId} ORDER BY schedDate
		<if test="startPage != null">
			LIMIT #{startPage}, #{limit}
		</if>
	</select>
  
  <select id="getAllPlanByReceiptId" resultMap="BaseResultMap" parameterType="Map">
   	select 
  	<include refid="Base_Column_List"/>
  	from t_repayment_plan
  	where receiptId=#{receiptId}
  </select>
  
  <select id="getPlanByReceiptIdAndPeriod" resultMap="BaseResultMap" parameterType="Map">
  	select 
    <include refid="Base_Column_List" />
    from t_repayment_plan
    where receiptId = #{receiptId,jdbcType=VARCHAR}
    and period = #{period,jdbcType=VARCHAR}
  </select>

  
  <select id="getDueRepaymentSevenDaysLater" resultType="Map" parameterType="Map">
  	select a.receiptId, a.period, a.schedDate, a.schedPrincipal, a.schedInterest, a.unpaidInterest, a.schedTotalAmt, c.mobilePhone, b.loanTotalBalance, b.paybackWay, b.loanPaybackWay
  	, b.payAccount, b.contNo, b.custId from t_repayment_plan a left join t_receipt_info b on 
  	a.receiptId = b.receiptId left join t_customer_info c on b.custId = c.custId where a.schedDate  = #{schedDate} and payoffFlag = #{payoffFlag}
  </select>
  

  <delete id="deleteByReceiptId" parameterType="java.lang.String">
  	delete from t_repayment_plan where receiptId = #{receiptId}
  </delete>
</mapper>